\hypertarget{kernel_8c}{}\doxysection{/\+Users/cryptic/source/x8\+A4/\+Kernel/kernel.c File Reference}
\label{kernel_8c}\index{/Users/cryptic/source/x8A4/Kernel/kernel.c@{/Users/cryptic/source/x8A4/Kernel/kernel.c}}


This file is for all kernel related code.  


{\ttfamily \#include $<$libkrw.\+h$>$}\newline
{\ttfamily \#include $<$sys/mount.\+h$>$}\newline
{\ttfamily \#include $<$x8\+A4/\+Kernel/kernel.\+h$>$}\newline
{\ttfamily \#include $<$x8\+A4/\+Kernel/offsets.\+h$>$}\newline
{\ttfamily \#include $<$x8\+A4/\+Kernel/slide.\+h$>$}\newline
{\ttfamily \#include $<$x8\+A4/\+Services/services.\+h$>$}\newline
{\ttfamily \#include $<$x8\+A4/\+Registry/registry.\+h$>$}\newline
{\ttfamily \#include $<$x8\+A4/\+Logger/logger.\+h$>$}\newline
{\ttfamily \#include $<$x8\+A4/x8\+A4.\+h$>$}\newline
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
uint64\+\_\+t \mbox{\hyperlink{kernel_8c_af6f3ef808f94bca0e2255ac4d159ab38}{krw\+\_\+get\+\_\+kbase}} (void)
\begin{DoxyCompactList}\small\item\em Get kernel\textquotesingle{}s base from the libkrw library. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{kernel_8c_a77f7538dd74676922293765df0747d82}{tfp0\+\_\+init}} (void)
\begin{DoxyCompactList}\small\item\em Verifies if tfp0 kread works. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{kernel_8c_adc71c3f0178b000a94bddcbac0b7690e}{xpf\+\_\+init}} (void)
\begin{DoxyCompactList}\small\item\em Initializes XPF lib with filesystem kernel. \end{DoxyCompactList}\item 
const char $\ast$ \mbox{\hyperlink{kernel_8c_af4bb7d4b160afc55e3cb750ea5a0831b}{get\+\_\+kernel\+\_\+path}} (void)
\begin{DoxyCompactList}\small\item\em Get the path to the filesystem kernel inside preboot. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{kernel_8c_a6b7b15fd57888666a9d47c1ce0c774c8}{kread\+\_\+smr}} (uint64\+\_\+t addr, uint64\+\_\+t $\ast$value, size\+\_\+t sz)
\begin{DoxyCompactList}\small\item\em Kernel kread wrapper for reading from SMR pointers. \end{DoxyCompactList}\item 
uint64\+\_\+t \mbox{\hyperlink{kernel_8c_a761a29721402b2e506c4fe8843194d78}{unsign\+\_\+ptr}} (uint64\+\_\+t $\ast$addr)
\begin{DoxyCompactList}\small\item\em Unsign a PAC signed pointer addr with t1sz. \end{DoxyCompactList}\item 
uint64\+\_\+t \mbox{\hyperlink{kernel_8c_a2220bb95b5be2eedfea3b5218733d30d}{get\+\_\+our\+\_\+proc}} (void)
\begin{DoxyCompactList}\small\item\em Traverses kernel proc struct to find our pid\textquotesingle{}s proc entry. \end{DoxyCompactList}\item 
uint64\+\_\+t \mbox{\hyperlink{kernel_8c_a7c2c27af795dcbaf26d3aef4410b4cac}{get\+\_\+our\+\_\+task}} (void)
\begin{DoxyCompactList}\small\item\em Gets our task struct from our proc. \end{DoxyCompactList}\item 
uint64\+\_\+t \mbox{\hyperlink{kernel_8c_aa444c95590f146778bfbe8c94d41ee07}{get\+\_\+ipc\+\_\+port}} (mach\+\_\+port\+\_\+name\+\_\+t port\+\_\+name)
\begin{DoxyCompactList}\small\item\em Get ipc\+\_\+port address a from port name. \end{DoxyCompactList}\item 
uint64\+\_\+t \mbox{\hyperlink{kernel_8c_ae40bbc1fd445234966d18e78aa237ec3}{get\+\_\+ipc\+\_\+kobject\+\_\+from\+\_\+iomachport}} (uint64\+\_\+t port\+\_\+addr)
\begin{DoxyCompactList}\small\item\em Gets the ipc\+\_\+kobject from the IOMach\+Port address. \end{DoxyCompactList}\item 
uint64\+\_\+t \mbox{\hyperlink{kernel_8c_aea0985217b709bcc6f35c64fbfda7449}{get\+\_\+ipc\+\_\+kobject}} (io\+\_\+service\+\_\+t service)
\begin{DoxyCompactList}\small\item\em Gets a service\textquotesingle{}s kobject from an ipc\+\_\+port address. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{kernel_8c_ac84c7c07eb5b6136f22f05bbc341683b}{io\+\_\+generate\+\_\+apnonce}} (void)
\begin{DoxyCompactList}\small\item\em Generates a new apnonce and generator via Apple\+Mobile\+Ap\+Nonce User\+Client. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{kernel_8c_a2105bcd7090bc2d267d8d39bdcdb51b3}{io\+\_\+clear\+\_\+apnonce}} (void)
\begin{DoxyCompactList}\small\item\em Clears the apnonce and generator via Apple\+Mobile\+Ap\+Nonce User\+Client. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{kernel_8c_a0125cbb11b07bedd16a91f7d8917df55}\label{kernel_8c_a0125cbb11b07bedd16a91f7d8917df55}} 
char $\ast$ {\bfseries kernel\+\_\+path\+\_\+cached} = NULL
\item 
\mbox{\Hypertarget{kernel_8c_a3fd58105463c02724c6b8a144fc43d6b}\label{kernel_8c_a3fd58105463c02724c6b8a144fc43d6b}} 
uint64\+\_\+t {\bfseries our\+\_\+proc\+\_\+cached} = 0
\item 
\mbox{\Hypertarget{kernel_8c_adebcb82b567e1c87b85da22fba337064}\label{kernel_8c_adebcb82b567e1c87b85da22fba337064}} 
uint64\+\_\+t {\bfseries our\+\_\+task\+\_\+cached} = 0
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
This file is for all kernel related code. 

\begin{DoxyAuthor}{Author}
Cryptiiiic 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+0.\+0 
\end{DoxyVersion}
\begin{DoxyDate}{Date}
2024-\/04-\/14
\end{DoxyDate}
\begin{DoxyCopyright}{Copyright}
Copyright (c) 2024 
\end{DoxyCopyright}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{kernel_8c_aea0985217b709bcc6f35c64fbfda7449}\label{kernel_8c_aea0985217b709bcc6f35c64fbfda7449}} 
\index{kernel.c@{kernel.c}!get\_ipc\_kobject@{get\_ipc\_kobject}}
\index{get\_ipc\_kobject@{get\_ipc\_kobject}!kernel.c@{kernel.c}}
\doxysubsubsection{\texorpdfstring{get\_ipc\_kobject()}{get\_ipc\_kobject()}}
{\footnotesize\ttfamily uint64\+\_\+t get\+\_\+ipc\+\_\+kobject (\begin{DoxyParamCaption}\item[{io\+\_\+service\+\_\+t}]{service }\end{DoxyParamCaption})}



Gets a service\textquotesingle{}s kobject from an ipc\+\_\+port address. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em service} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Address of kobject in kernel space 
\end{DoxyReturn}
\mbox{\Hypertarget{kernel_8c_ae40bbc1fd445234966d18e78aa237ec3}\label{kernel_8c_ae40bbc1fd445234966d18e78aa237ec3}} 
\index{kernel.c@{kernel.c}!get\_ipc\_kobject\_from\_iomachport@{get\_ipc\_kobject\_from\_iomachport}}
\index{get\_ipc\_kobject\_from\_iomachport@{get\_ipc\_kobject\_from\_iomachport}!kernel.c@{kernel.c}}
\doxysubsubsection{\texorpdfstring{get\_ipc\_kobject\_from\_iomachport()}{get\_ipc\_kobject\_from\_iomachport()}}
{\footnotesize\ttfamily uint64\+\_\+t get\+\_\+ipc\+\_\+kobject\+\_\+from\+\_\+iomachport (\begin{DoxyParamCaption}\item[{uint64\+\_\+t}]{port\+\_\+addr }\end{DoxyParamCaption})}



Gets the ipc\+\_\+kobject from the IOMach\+Port address. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em port\+\_\+addr} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Address of kobject in kernel space 
\end{DoxyReturn}
\mbox{\Hypertarget{kernel_8c_aa444c95590f146778bfbe8c94d41ee07}\label{kernel_8c_aa444c95590f146778bfbe8c94d41ee07}} 
\index{kernel.c@{kernel.c}!get\_ipc\_port@{get\_ipc\_port}}
\index{get\_ipc\_port@{get\_ipc\_port}!kernel.c@{kernel.c}}
\doxysubsubsection{\texorpdfstring{get\_ipc\_port()}{get\_ipc\_port()}}
{\footnotesize\ttfamily uint64\+\_\+t get\+\_\+ipc\+\_\+port (\begin{DoxyParamCaption}\item[{mach\+\_\+port\+\_\+name\+\_\+t}]{port\+\_\+name }\end{DoxyParamCaption})}



Get ipc\+\_\+port address a from port name. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em port\+\_\+name} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Address of an ipc\+\_\+port in kernel space 
\end{DoxyReturn}
\mbox{\Hypertarget{kernel_8c_af4bb7d4b160afc55e3cb750ea5a0831b}\label{kernel_8c_af4bb7d4b160afc55e3cb750ea5a0831b}} 
\index{kernel.c@{kernel.c}!get\_kernel\_path@{get\_kernel\_path}}
\index{get\_kernel\_path@{get\_kernel\_path}!kernel.c@{kernel.c}}
\doxysubsubsection{\texorpdfstring{get\_kernel\_path()}{get\_kernel\_path()}}
{\footnotesize\ttfamily const char $\ast$ get\+\_\+kernel\+\_\+path (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Get the path to the filesystem kernel inside preboot. 

\begin{DoxyReturn}{Returns}
Kernel path 
\end{DoxyReturn}
\mbox{\Hypertarget{kernel_8c_a2220bb95b5be2eedfea3b5218733d30d}\label{kernel_8c_a2220bb95b5be2eedfea3b5218733d30d}} 
\index{kernel.c@{kernel.c}!get\_our\_proc@{get\_our\_proc}}
\index{get\_our\_proc@{get\_our\_proc}!kernel.c@{kernel.c}}
\doxysubsubsection{\texorpdfstring{get\_our\_proc()}{get\_our\_proc()}}
{\footnotesize\ttfamily uint64\+\_\+t get\+\_\+our\+\_\+proc (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Traverses kernel proc struct to find our pid\textquotesingle{}s proc entry. 

\begin{DoxyReturn}{Returns}
Address of our proc\textquotesingle{}s proc entry 
\end{DoxyReturn}
\mbox{\Hypertarget{kernel_8c_a7c2c27af795dcbaf26d3aef4410b4cac}\label{kernel_8c_a7c2c27af795dcbaf26d3aef4410b4cac}} 
\index{kernel.c@{kernel.c}!get\_our\_task@{get\_our\_task}}
\index{get\_our\_task@{get\_our\_task}!kernel.c@{kernel.c}}
\doxysubsubsection{\texorpdfstring{get\_our\_task()}{get\_our\_task()}}
{\footnotesize\ttfamily uint64\+\_\+t get\+\_\+our\+\_\+task (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Gets our task struct from our proc. 

\begin{DoxyReturn}{Returns}
Address of our proc\textquotesingle{}s task struct 
\end{DoxyReturn}
\mbox{\Hypertarget{kernel_8c_a2105bcd7090bc2d267d8d39bdcdb51b3}\label{kernel_8c_a2105bcd7090bc2d267d8d39bdcdb51b3}} 
\index{kernel.c@{kernel.c}!io\_clear\_apnonce@{io\_clear\_apnonce}}
\index{io\_clear\_apnonce@{io\_clear\_apnonce}!kernel.c@{kernel.c}}
\doxysubsubsection{\texorpdfstring{io\_clear\_apnonce()}{io\_clear\_apnonce()}}
{\footnotesize\ttfamily int io\+\_\+clear\+\_\+apnonce (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Clears the apnonce and generator via Apple\+Mobile\+Ap\+Nonce User\+Client. 

\begin{DoxyReturn}{Returns}
Zero on success 
\end{DoxyReturn}
\mbox{\Hypertarget{kernel_8c_ac84c7c07eb5b6136f22f05bbc341683b}\label{kernel_8c_ac84c7c07eb5b6136f22f05bbc341683b}} 
\index{kernel.c@{kernel.c}!io\_generate\_apnonce@{io\_generate\_apnonce}}
\index{io\_generate\_apnonce@{io\_generate\_apnonce}!kernel.c@{kernel.c}}
\doxysubsubsection{\texorpdfstring{io\_generate\_apnonce()}{io\_generate\_apnonce()}}
{\footnotesize\ttfamily int io\+\_\+generate\+\_\+apnonce (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Generates a new apnonce and generator via Apple\+Mobile\+Ap\+Nonce User\+Client. 

\begin{DoxyReturn}{Returns}
Zero on success 
\end{DoxyReturn}
\mbox{\Hypertarget{kernel_8c_a6b7b15fd57888666a9d47c1ce0c774c8}\label{kernel_8c_a6b7b15fd57888666a9d47c1ce0c774c8}} 
\index{kernel.c@{kernel.c}!kread\_smr@{kread\_smr}}
\index{kread\_smr@{kread\_smr}!kernel.c@{kernel.c}}
\doxysubsubsection{\texorpdfstring{kread\_smr()}{kread\_smr()}}
{\footnotesize\ttfamily int kread\+\_\+smr (\begin{DoxyParamCaption}\item[{uint64\+\_\+t}]{addr,  }\item[{uint64\+\_\+t $\ast$}]{value,  }\item[{size\+\_\+t}]{sz }\end{DoxyParamCaption})}



Kernel kread wrapper for reading from SMR pointers. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em addr} & \\
\hline
\mbox{\texttt{ out}}  & {\em value} & \\
\hline
\mbox{\texttt{ in}}  & {\em sz} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Zero on success 
\end{DoxyReturn}
\mbox{\Hypertarget{kernel_8c_af6f3ef808f94bca0e2255ac4d159ab38}\label{kernel_8c_af6f3ef808f94bca0e2255ac4d159ab38}} 
\index{kernel.c@{kernel.c}!krw\_get\_kbase@{krw\_get\_kbase}}
\index{krw\_get\_kbase@{krw\_get\_kbase}!kernel.c@{kernel.c}}
\doxysubsubsection{\texorpdfstring{krw\_get\_kbase()}{krw\_get\_kbase()}}
{\footnotesize\ttfamily uint64\+\_\+t krw\+\_\+get\+\_\+kbase (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Get kernel\textquotesingle{}s base from the libkrw library. 

\begin{DoxyReturn}{Returns}
Kernel base, zero on failure 
\end{DoxyReturn}
\mbox{\Hypertarget{kernel_8c_a77f7538dd74676922293765df0747d82}\label{kernel_8c_a77f7538dd74676922293765df0747d82}} 
\index{kernel.c@{kernel.c}!tfp0\_init@{tfp0\_init}}
\index{tfp0\_init@{tfp0\_init}!kernel.c@{kernel.c}}
\doxysubsubsection{\texorpdfstring{tfp0\_init()}{tfp0\_init()}}
{\footnotesize\ttfamily int tfp0\+\_\+init (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Verifies if tfp0 kread works. 

\begin{DoxyReturn}{Returns}
Zero on kread success 
\end{DoxyReturn}
\mbox{\Hypertarget{kernel_8c_a761a29721402b2e506c4fe8843194d78}\label{kernel_8c_a761a29721402b2e506c4fe8843194d78}} 
\index{kernel.c@{kernel.c}!unsign\_ptr@{unsign\_ptr}}
\index{unsign\_ptr@{unsign\_ptr}!kernel.c@{kernel.c}}
\doxysubsubsection{\texorpdfstring{unsign\_ptr()}{unsign\_ptr()}}
{\footnotesize\ttfamily uint64\+\_\+t unsign\+\_\+ptr (\begin{DoxyParamCaption}\item[{uint64\+\_\+t $\ast$}]{addr }\end{DoxyParamCaption})}



Unsign a PAC signed pointer addr with t1sz. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em addr} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Unsigned addr 
\end{DoxyReturn}
\mbox{\Hypertarget{kernel_8c_adc71c3f0178b000a94bddcbac0b7690e}\label{kernel_8c_adc71c3f0178b000a94bddcbac0b7690e}} 
\index{kernel.c@{kernel.c}!xpf\_init@{xpf\_init}}
\index{xpf\_init@{xpf\_init}!kernel.c@{kernel.c}}
\doxysubsubsection{\texorpdfstring{xpf\_init()}{xpf\_init()}}
{\footnotesize\ttfamily int xpf\+\_\+init (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Initializes XPF lib with filesystem kernel. 

\begin{DoxyReturn}{Returns}
Zero on XPF init success 
\end{DoxyReturn}
